(this["webpackJsonpfestival-poster-app"]=this["webpackJsonpfestival-poster-app"]||[]).push([[0],{30:function(t,e,n){t.exports=n.p+"static/media/fireworks.c1f1ed0c.jpg"},39:function(t,e,n){t.exports=n.p+"static/media/city.7878fa91.jpg"},40:function(t,e,n){t.exports=n.p+"static/media/desert.1f4ebc63.png"},49:function(t,e,n){t.exports=n(77)},50:function(t,e,n){},51:function(t,e,n){},56:function(t,e,n){},57:function(t,e,n){},66:function(t,e,n){},68:function(t,e,n){},77:function(t,e,n){"use strict";n.r(e);n(50),n(51);var a=n(0),r=n.n(a),i=n(19),o=n.n(i),c=(n(56),n(7)),s=n(89),u=n(90),l=n(83),h=n(84),f=(n(57),n(14)),d=n(12),p=n(13),v=n(8),m=n(16),b=n(48),g=function(t){var e=t instanceof y?t.type:null;return{message:t.message,name:t.name,stack:t.stack,type:e}},y=function(t){function e(t,n){var a;return Object(v.a)(this,e),(a=Object(f.a)(this,Object(d.a)(e).call(this,t)))._type=null,n&&(a._type=n),a}return Object(p.a)(e,t),Object(m.a)(e,[{key:"toJSON",value:function(){return g(this)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t}}]),e}(Object(b.a)(Error)),w=n(15),E=n(22),x=n(17),k=Object(E.b)({name:"system",initialState:{spotifyAccessToken:"",spotifyAccessTokenExpire:"",error:{isError:!1}},reducers:{accessTokenUpdated:function(t,e){return Object(x.a)(t,(function(t){t.spotifyAccessToken=e.payload.spotifyAccessToken,t.spotifyAccessTokenExpire=e.payload.spotifyAccessTokenExpire,""!==e.payload.spotifyAccessToken&&t.error.isError&&"NoSpotifyAccess"===t.error.error.type&&(t.error={isError:!1})}))},caughtGlobalError:function(t,e){return Object(x.a)(t,(function(t){t.error={isError:!0,error:g(e.payload)}}))},clearGlobalError:function(t){return Object(x.a)(t,(function(t){t.error={isError:!1}}))}}}),O=k.actions,j=O.accessTokenUpdated,A=O.caughtGlobalError,S=(O.clearGlobalError,k.reducer),C=.8*window.innerHeight,T={artists:[],topArtistsTimeRange:"medium_term",layoutType:"basic",themeType:"theme1",width:.65*C,height:C},R=Object(E.b)({name:"poster",initialState:T,reducers:{changeThemeType:function(t,e){return Object(x.a)(t,(function(t){t.themeType=e.payload}))},changeLayoutType:function(t,e){return Object(x.a)(t,(function(t){t.layoutType=e.payload}))},updateArtistList:function(t,e){return Object(x.a)(t,(function(t){t.artists=e.payload}))},topArtistsTimeRangeUpdated:function(t,e){return Object(x.a)(t,(function(t){t.topArtistsTimeRange=e.payload}))}}}),N=R.actions,_=N.changeThemeType,I=N.updateArtistList,F=N.topArtistsTimeRangeUpdated,P=N.changeLayoutType,B=R.reducer,D=n(9),L=Object(w.combineReducers)({poster:B,system:S}),U=function(t){return Object(D.c)(t)},H=function(t,e,n){var a=t.getContext("2d");if(!a)throw new Error("Could not get canvas context to create HiDPI canvas");var r=function(t){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}(a);return t.width=e*r,t.height=n*r,t.style.width=e+"px",t.style.height=n+"px",a.setTransform(r,0,0,r,0,0),t},W=n(39),M=n.n(W),z=n(30),G=n.n(z),K=n(40),X=n.n(K),J=G.a,Y=function t(){Object(v.a)(this,t),this.backgroundImage=J,this.festivalNameColor="white",this.festivalNameFont="serif",this.artistFont="serif",this.artistColor="white",this.textMargin=0},Z=function(t){function e(){var t,n;Object(v.a)(this,e);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(r)))).backgroundImage=G.a,n.festivalNameColor="#37C3E1",n.festivalNameFont="serif",n.artistFont="serif",n.artistColor="#37C3E1",n}return Object(p.a)(e,t),e}(Y),V=function(t){function e(){var t,n;Object(v.a)(this,e);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(r)))).backgroundImage=M.a,n.festivalNameColor="lime",n.festivalNameFont="serif",n.artistFont="serif",n.artistColor="lime",n}return Object(p.a)(e,t),e}(Y),$=function(t){function e(){var t,n;Object(v.a)(this,e);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(r)))).backgroundImage=X.a,n.festivalNameColor="orange",n.festivalNameFont="TexasTango",n.artistFont="WesternBangBang",n.artistColor="orange",n.textMargin=20,n}return Object(p.a)(e,t),e}(Y),q=function(){function t(e){Object(v.a)(this,t),this._poster=e,this.artistTopRatio=.5,this.artistFontRatio=.025,this.festivalNameFontRatio=.1}return Object(m.a)(t,[{key:"fontString",value:function(t,e){return"".concat(this.fontHeight(t),"px ").concat(e)}},{key:"fontHeight",value:function(t){return Math.floor(t*this.poster.h)}},{key:"cutTrailingChar",value:function(t){return t.slice(0,t.length-1)}},{key:"calculateTextWidth",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=e.reduce((function(t,e){return t+e}),""),r=this.ctx.measureText(a),i=2*this.theme.textMargin;return Math.ceil(r.width)+i}},{key:"artistLines",value:function(){var t=[],e=this.poster;this.ctx.font=this.fontString(this.artistFontRatio,this.theme.artistFont);var n="",a=!0,r=!1,i=void 0;try{for(var o,c=this.poster.artistNames[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var s=o.value;this.calculateTextWidth(n,s)>this.posterWidth?(t.push(this.cutTrailingChar(n)),n=s+e.artistSeperator):n=n+s+e.artistSeperator}}catch(u){r=!0,i=u}finally{try{a||null==c.return||c.return()}finally{if(r)throw i}}return""!==n&&t.push(this.cutTrailingChar(n)),t}},{key:"drawArtistBlock",value:function(){var t=this,e=this.poster.canvasCtx,n=this.posterHeight*this.artistTopRatio,a=this.artistLines();e.textBaseline="top",e.textAlign="center",e.fillStyle=this.theme.artistColor;var r=this.fontHeight(this.artistFontRatio);a.forEach((function(e,a){var i=n+(a+1)*r;t.printCenter(e,i)}))}},{key:"printCenter",value:function(t,e){var n=this.ctx;n.textAlign="center",n.fillText(t,this.midX,e,this.maxPosterWidth)}},{key:"printLeft",value:function(t,e){var n=this.ctx;n.textAlign="left",n.fillText(t,this.theme.textMargin,e,this.maxPosterWidth)}},{key:"printRight",value:function(t,e){this.ctx.textAlign="right",this.ctx.fillText(t,this.posterWidth-this.theme.textMargin,e,this.maxPosterWidth)}},{key:"drawFestivalName",value:function(){var t=this.poster.canvasCtx;t.font=this.fontString(this.festivalNameFontRatio,this.theme.festivalNameFont),t.fillStyle=this.theme.festivalNameColor,t.textBaseline="top",t.textAlign="center",t.strokeStyle="black",t.lineWidth=2,this.printCenter(this.poster.festivalName,30)}},{key:"poster",set:function(t){this._poster=t},get:function(){if(!this._poster)throw new Error("Expected poster to be set before drawing");return this._poster}},{key:"ctx",get:function(){return this.poster.canvasCtx}},{key:"theme",get:function(){return this.poster.theme}},{key:"midX",get:function(){return Math.floor(this.posterWidth/2)}},{key:"midY",get:function(){return Math.floor(this.posterHeight/2)}},{key:"posterWidth",get:function(){return this.poster.w}},{key:"maxPosterWidth",get:function(){return this.posterWidth-2*this.theme.textMargin}},{key:"posterHeight",get:function(){return this.poster.h}}]),t}(),Q=function(t){function e(){return Object(v.a)(this,e),Object(f.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),e}(q),tt=function(t){function e(){var t,n;Object(v.a)(this,e);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(f.a)(this,(t=Object(d.a)(e)).call.apply(t,[this].concat(r)))).artistTopRatio=.4,n.artistFontRatio=.02,n}return Object(p.a)(e,t),Object(m.a)(e,[{key:"dayFont",value:function(){this.ctx.font=this.fontString(2*this.artistFontRatio,this.theme.artistFont)}},{key:"artistFont",value:function(){this.ctx.font=this.fontString(this.artistFontRatio,this.theme.artistFont)}},{key:"drawArtistBlock",value:function(){var t=this,e=this.artistLines(),n=Math.ceil(e.length/3),a=e.slice(0,n),r=e.slice(n,2*n),i=e.slice(2*n);this.ctx.textBaseline="bottom",this.ctx.fillStyle=this.theme.artistColor;var o=this.posterHeight*this.artistTopRatio,c=this.fontHeight(this.artistFontRatio);this.dayFont(),this.printLeft("FRIDAY",o),this.artistFont(),a.forEach((function(e,n){o+=c,t.printLeft(e,o)})),o+=3*c,this.dayFont(),this.printRight("SATURDAY",o),this.artistFont(),r.forEach((function(e,n){o+=c,t.printRight(e,o)})),o+=3*c,this.ctx.textAlign="left",this.dayFont(),this.printLeft("SUNDAY",o),this.artistFont(),i.forEach((function(e,n){o+=c,t.printLeft(e,o)}))}}]),e}(q),et=function(t){function e(){return Object(v.a)(this,e),Object(f.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),e}(function(){function t(e,n,a){Object(v.a)(this,t),this.ps=e,this.theme=n,this.layout=a,this.canvasCtx=void 0,this._w=600,this._h=900,this._postDrawCB=void 0,this.festivalNameText="My Festival",this.festivalNameCase="upper",this.artistCase="upper",this.layout.poster=this}return Object(m.a)(t,[{key:"getContext",value:function(t){var e=t.getContext("2d");if(!e)throw new y("Expected canvas context");return e}},{key:"setPosterSize",value:function(t,e){this._w=t,this._h=e}},{key:"_drawBGImage",value:function(t,e){var n=this.getContext(t),a=Math.max(t.width/e.width,t.height/e.height),r=t.width/2-e.width/2*a,i=t.height/2-e.height/2*a;n.drawImage(e,r,i,e.width*a,e.height*a)}},{key:"_draw",value:function(){this.layout.drawFestivalName(),this.layout.drawArtistBlock()}},{key:"draw",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.canvasCtx=this.getContext(t),t.width=this.w,t.height=this.h,H(t,this.w,this.h);var a=function(){e._draw(),e._postDrawCB&&e._postDrawCB()};n?this.drawBackground(t,a.bind(this)):this._draw()}},{key:"drawBackground",value:function(t,e){var n=this,a=new Image(this.w,this.h);t.width=this.w,t.height=this.h,a.onload=function(){n._drawBGImage(t,a),e&&e()},a.src=this.theme.backgroundImage}},{key:"h",get:function(){return this._h}},{key:"w",get:function(){return this._w}},{key:"artistSeperator",get:function(){return String.fromCharCode(8226)}},{key:"festivalName",get:function(){return"upper"===this.festivalNameCase?this.festivalNameText.toUpperCase():this.festivalNameText}},{key:"artistNames",get:function(){var t=this;return this.ps.artists.filter((function(t){return t.isSelected})).map((function(e){var n=e.data.name;return"upper"===t.artistCase&&(n=n.toUpperCase()),n}))}},{key:"postDrawCB",set:function(t){this._postDrawCB=t}}]),t}()),nt=function(){var t=function(){var t,e=U((function(t){return t.poster.themeType}));switch(e){case"theme1":t=new Z;break;case"theme2":t=new V;break;case"desert":t=new $;break;default:throw new y("Invalid theme ".concat(e))}return t}(),e=function(){var t,e=U((function(t){return t.poster.layoutType}));switch(e){case"basic":t=new Q;break;case"weekend":t=new tt;break;default:throw new y("Invalid theme ".concat(e))}return t}(),n=U((function(t){return t.poster}));return new et(n,t,e)},at=[2,3],rt=function(t){return t*(at[1]/at[0])},it=function(t){var e=t.parentWidth,n=t.parentHeight,i=nt(),o=Object(a.useRef)(null),c=Object(a.useRef)(null),s=function(t,e){var n=t;n>600&&(n=600);for(var a=rt(n);a>=e;)a=rt(n-=5);return{w:n,h:a}}(e||0,n||0),u=s.w,l=s.h;i.setPosterSize(u,l),console.log(u,l),Object(a.useEffect)((function(){var t=o.current;if(!t)throw new Error("Unable to retreive poster canvas element");i.draw(t,!1)})),Object(a.useEffect)((function(){var t=c.current;if(!t)throw new Error("Unable to retreive poster background canvas element");i.drawBackground(t)}),[i]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("canvas",{id:"poster-bg",ref:c,style:{position:"relative"}},"Poster BackGround"),r.a.createElement("canvas",{ref:o,id:"poster-canvas",style:{position:"absolute"}},"Festival Poster Viewer"))},ot=n(82),ct=n(78),st=n(79),ut=n(80),lt=function(t,e,n){var r=Object(a.useState)(e),i=Object(c.a)(r,2),o=i[0],s=i[1];return[o,{options:t,selected:o,handleChange:function(t){s(t),n&&n(t)}}]},ht=function(t){var e=t.options,n=t.handleChange,a=t.selected,i=t.labelText,o=e.map((function(t){return r.a.createElement("option",{key:t.value,value:t.value},t.text)}));return r.a.createElement(ct.a,null,i&&r.a.createElement(st.a,null,i),r.a.createElement(ut.a,{type:"select",value:a,onChange:function(t){n&&n(t.target.value)}},o))},ft=n(28),dt=n(81),pt=function(t){var e=t.children,n=Object(ft.a)(t,["children"]),a=n.color?n.color:"primary",i=n.size?n.size:"sm";return r.a.createElement(dt.a,Object.assign({color:a,size:i,onClick:function(t){var e;t.stopPropagation(),null===(e=n.onClick)||void 0===e||e.call(n,t)}},n),e)},vt=[{text:"Desert",value:"desert"},{text:"Theme 1",value:"theme1"},{text:"Theme 2",value:"theme2"}],mt=[{text:"Basic",value:"basic"},{text:"Weekend",value:"weekend"}],bt=function(){var t=Object(D.b)(),e=U((function(t){return t.poster.themeType})),n=U((function(t){return t.poster.layoutType})),i=lt(vt,e,(function(e){t(_(e))})),o=Object(c.a)(i,2)[1],s=lt(mt,n,(function(e){t(P(e))})),u=Object(c.a)(s,2)[1],f=function(){var t=nt();return Object(a.useCallback)((function(){var e=document.getElementById("poster-canvas");if(!e)throw new Error("Expected canvas node");t.postDrawCB=function(){var t=e.toDataURL("image/jpeg",1),n=window.open("_blank");null===n||void 0===n||n.document.write('<img src="'.concat(t,'"></img>'))},t.draw(e,!0)}),[t])}();return r.a.createElement("div",null,r.a.createElement(ot.a,null,r.a.createElement(l.a,{form:!0},r.a.createElement(h.a,{md:6,xs:6},r.a.createElement(ht,Object.assign({labelText:"Theme"},o))),r.a.createElement(h.a,{md:6,xs:6},r.a.createElement(ht,Object.assign({labelText:"Text Layout"},u))),r.a.createElement(h.a,{md:6,xs:6}))),r.a.createElement(pt,{color:"warning",onClick:function(){return f()}},"Create Image"))},gt=(n(66),n(6)),yt=n.n(gt),wt=n(23),Et="https://api.spotify.com",xt="v1",kt=function(){function t(e){Object(v.a)(this,t),this.apiKey=e}return Object(m.a)(t,[{key:"getPlaylistArtists",value:function(t){var e;return yt.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,yt.a.awrap(this.getPlaylistTracks(t));case 2:if(!((e=n.sent)instanceof y)){n.next=5;break}return n.abrupt("return",e);case 5:return n.abrupt("return",_t(e));case 6:case"end":return n.stop()}}),null,this)}},{key:"noAuthAPICall",value:function(t){var e,n;return yt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,yt.a.awrap(fetch(t));case 3:return e=a.sent,a.next=6,yt.a.awrap(St(e,t));case 6:return n=a.sent,a.abrupt("return",n);case 10:return a.prev=10,a.t0=a.catch(0),a.abrupt("return",a.t0);case 13:case"end":return a.stop()}}),null,null,[[0,10]])}}]),t}(),Ot=function(t){function e(){return Object(v.a)(this,e),Object(f.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(m.a)(e,[{key:"getPlaylists",value:function(){return t=this.apiKey,yt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Rt(t,["me","playlists"]));case 1:case"end":return e.stop()}}));var t}},{key:"getPlaylistTracks",value:function(t){return function(t,e){var n;return yt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,yt.a.awrap(Rt(t,["playlists",e,"tracks"]));case 2:if(!((n=a.sent)instanceof y)){a.next=5;break}return a.abrupt("return",n);case 5:return a.abrupt("return",n.map((function(t){return t.track})));case 6:case"end":return a.stop()}}))}(this.apiKey,t)}},{key:"me",value:function(){return yt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Nt(this.apiKey));case 1:case"end":return t.stop()}}),null,this)}},{key:"topArtists",value:function(){var t,e,n,a,r,i,o,c,s=arguments;return yt.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},e=t.limit,n=void 0===e?"50":e,a=t.offset,r=void 0===a?"0":a,i=t.time_range,o=void 0===i?"medium_term":i,u.next=3,yt.a.awrap(Rt(this.apiKey,["me","top","artists"],{limit:n,offset:r,time_range:o}));case 3:return c=u.sent,u.abrupt("return",c);case 5:case"end":return u.stop()}}),null,this)}}]),e}(kt),jt=function(t){function e(){return Object(v.a)(this,e),Object(f.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(m.a)(e,[{key:"getPlaylists",value:function(){var t;return yt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t=At("users",this.apiKey,"playlists"),e.next=3,yt.a.awrap(this.noAuthAPICall(t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),null,this)}},{key:"getPlaylistTracks",value:function(t){var e;return yt.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=At("playlists",this.apiKey,"tracks"),t.next=3,yt.a.awrap(this.noAuthAPICall(e));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),null,this)}},{key:"me",value:function(){var t;return yt.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t=At("users",this.apiKey),e.next=3,yt.a.awrap(this.noAuthAPICall(t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),null,this)}}]),e}(kt);function At(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=[xt].concat(e).join("/");return new URL(a,Et).href}function St(t,e){var n;return yt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.ok){a.next=4;break}if(401!==t.status){a.next=3;break}return a.abrupt("return",new y("Fetch for URL ".concat(e," returned not ok status.  Status: ").concat(t.status),"NoSpotifyAccess"));case 3:return a.abrupt("return",new y("Fetch for URL ".concat(e," returned not ok status.  Status: ").concat(t.status),"NoSpotifyAccess"));case 4:if(200===t.status){a.next=6;break}return a.abrupt("return",new y("Fetch for URL ".concat(e," returned a status of ").concat(t.status),"NoSpotifyAccess"));case 6:return a.prev=6,a.next=9,yt.a.awrap(t.json());case 9:return n=a.sent,a.abrupt("return",n);case 13:return a.prev=13,a.t0=a.catch(6),a.abrupt("return",a.t0);case 16:case"end":return a.stop()}}),null,null,[[6,13]])}function Ct(t,e){var n,a;return yt.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n={Authorization:"Bearer ".concat(t)},r.prev=1,r.next=4,yt.a.awrap(fetch(e,{headers:n}));case 4:return a=r.sent,r.abrupt("return",St(a,e));case 8:return r.prev=8,r.t0=r.catch(1),r.abrupt("return",r.t0);case 11:case"end":return r.stop()}}),null,null,[[1,8]])}function Tt(t){if(!t)return"";var e=new URLSearchParams;for(var n in t)e.append(n,t[n]);return e.toString()}function Rt(t,e,n){var a,r,i;return yt.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return a=Tt(n),r=At.apply(void 0,Object(wt.a)(e).concat(["?".concat(a)])),o.next=4,yt.a.awrap(Ct(t,r));case 4:if(!((i=o.sent)instanceof y)){o.next=7;break}return o.abrupt("return",i);case 7:if(i.hasOwnProperty("items")){o.next=9;break}throw new y("Returned paging object does not contain items field.  Url: ".concat(r));case 9:return o.abrupt("return",i.items);case 10:case"end":return o.stop()}}))}function Nt(t){var e,n;return yt.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e=At("me"),a.next=3,yt.a.awrap(Ct(t,e));case 3:return n=a.sent,a.abrupt("return",n);case 5:case"end":return a.stop()}}))}function _t(t){var e=new Set;return t.forEach((function(t){e.add(t.artists[0].name)})),Object(wt.a)(e)}function It(){var t=function(){var t=Object(a.useState)([0,0]),e=Object(c.a)(t,2),n=e[0],r=e[1];return Object(a.useLayoutEffect)((function(){function t(){r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[]),n}(),e=Object(c.a)(t,2),n=e[0],r=e[1],i=Object(a.useState)(null),o=Object(c.a)(i,2),s=o[0],u=o[1],l=Object(a.useRef)(null),h=l.current;return Object(a.useEffect)((function(){var t=null===h||void 0===h?void 0:h.getBoundingClientRect();u(t||null)}),[h,n,r]),[s,l]}var Ft=function(){return Math.floor(Date.now()/1e3)},Pt=function(){var t=U((function(t){return t.system.spotifyAccessToken})),e=U((function(t){return t.system.spotifyAccessTokenExpire}));if(""===t&&""===e)return{status:"NONE"};if(""===t||""===e)throw new Error("Spotify access token/expire in invalid state");return parseInt(e,10)<Ft()?{status:"EXPIRED"}:{status:"VALID",accessToken:t}},Bt=n(25),Dt=n(85),Lt=n(86),Ut=n(95),Ht=n(87);n(68);function Wt(t,e,n){t.preventDefault(),n(e)}var Mt=function(t){var e=t.rowNumber,n=t.disableActions,i=t.item,o=t.isEditing,s=t.setIsEditing,u=t.renderData,l=Object(ft.a)(t,["rowNumber","disableActions","item","isEditing","setIsEditing","renderData"]),h=Object(a.useState)(i.data),f=Object(c.a)(h,2),d=f[0],p=f[1],v=l.handleRemove,m=l.handleEdit,b=l.handleSelectionChange,g=l.canEditGlobal&&i.canEdit&&m,y=!(!l.canRemove||!v),w=!(!l.canSelect||void 0===b),E=!!i.isSelected;return o?r.a.createElement(Dt.a,null,r.a.createElement(Lt.a,null,r.a.createElement(ut.a,{value:d,style:{display:"inline"},onChange:function(t){p(t.target.value)}}),r.a.createElement(Ut.a,{addonType:"append"},r.a.createElement(pt,{onClick:function(t){if(!m)throw Error("Expected handleEdit to exist by this point");Wt(t,Xt(i,{data:d}),m),p(""),s(!1)}},"Save")),r.a.createElement(Ut.a,{addonType:"append"},r.a.createElement(pt,{color:"danger",onClick:function(t){p(""),s(!1)}},"X")))):function(){var t=w&&E;return r.a.createElement(Dt.a,{key:i.id,action:w,active:t,className:"noselect d-flex justify-content-between align-items-center py-1",onClick:function(t){var e;return null===(e=l.handleSelectionChange)||void 0===e?void 0:e.call(l,i)}},"number"===typeof e&&"".concat(e+1,". "),u(i.data),r.a.createElement(Ht.a,null,g&&m&&r.a.createElement(pt,{disabled:n,onClick:function(t){return s(!0)}},"Edit"),y&&v&&r.a.createElement(pt,{disabled:n,onClick:function(t){Wt(t,i,v)}},"Remove")),t?"\u2705":"\u274c")}()},zt=n(88),Gt=-1,Kt=function(){return++Gt};function Xt(t,e){return Object(Bt.a)({id:Kt()},t,{},e)}function Jt(t,e,n){return{handleRemove:function(n){var a;t((function(t){return t.filter((function(t){return t.id!==n.id}))})),null===e||void 0===e||null===(a=e.handleRemove)||void 0===a||a.call(e,n)},handleAddRow:function(a){var r,i,o=(null===n||void 0===n?void 0:null===(r=n.addRow)||void 0===r?void 0:r.call(n,a))||a;t((function(t){return[].concat(Object(wt.a)(t),[o])})),null===e||void 0===e||null===(i=e.handleAddRow)||void 0===i||i.call(e,o)},handleEdit:function(n){var a;t((function(t){var e=Object(wt.a)(t),a=e.find((function(t){return t.id===n.id}));if(!a)throw new Error("Could not find edited item: ".concat(JSON.stringify(n)));return a.data=n.data,e})),null===e||void 0===e||null===(a=e.handleEdit)||void 0===a||a.call(e,n)},handleSelectionChange:function(n){t((function(t){return Object(x.a)(t,(function(t){var a,r=t.findIndex((function(t){return t.id===n.id}));t[r].isSelected=!n.isSelected,null===e||void 0===e||null===(a=e.handleSelectionChange)||void 0===a||a.call(e,t[r])}))}))},handleSelectAll:function(){t((function(t){var e=t.map((function(t){return Object(Bt.a)({},t,{isSelected:!0})})),a=null===n||void 0===n?void 0:n.selectAll;return a&&(e=a(e)),e}))},handleClear:function(){t((function(t){var e=t.map((function(t){return Object(Bt.a)({},t,{isSelected:!1})})),a=null===n||void 0===n?void 0:n.clear;return a&&(e=a(e)),e}))}}}var Yt,Zt=function(t){var e=Object(a.useState)(!1),n=Object(c.a)(e,2),i=n[0],o=n[1],s=Object(a.useState)(""),u=Object(c.a)(s,2),l=u[0],h=u[1],f=Object(a.useState)(!1),d=Object(c.a)(f,2),p=d[0],v=d[1],m=t.items,b=t.canSelect&&t.handleSelectAll,g=t.canSelect&&t.handleClear,y=function(){var e=t.handleAddRow,n=t.canAddRow;return e&&n?i?r.a.createElement("div",null,r.a.createElement(Dt.a,null,r.a.createElement(Lt.a,null,r.a.createElement(ut.a,{value:l,onChange:function(t){return h(t.target.value)}}),r.a.createElement(Ht.a,null,r.a.createElement(pt,{onClick:function(){var t=Xt({data:l,userAdded:!0,isSelected:!1},{});o(!1),e(t),h("")}},"Save"),r.a.createElement(pt,{color:"danger",onClick:function(){o(!1),h("")}},"X"))))):r.a.createElement(Dt.a,null,r.a.createElement(pt,{block:!0,disabled:p,onClick:function(){return o(!0)}},"Add Row")):null},w=function(){return r.a.createElement("div",{className:"list__header",style:{display:"flex",justifyContent:"space-between"}},t.name?r.a.createElement("h3",null,t.name):null,function(){var e=null,n=null;return b&&(e=r.a.createElement(pt,{color:"success",onClick:function(e){var n;null===(n=t.handleSelectAll)||void 0===n||n.call(t)}},"Select All")),g&&(n=r.a.createElement(pt,{color:"warning",onClick:function(e){var n;null===(n=t.handleClear)||void 0===n||n.call(t)}},"Unselect All")),r.a.createElement("div",{className:"list__actions"},r.a.createElement(Ht.a,null,e,n))}())};return r.a.createElement("div",{className:"list"},function(){var e=m.map((function(e,n){var a=t.rowNumbers?n:void 0;return r.a.createElement(Mt,Object.assign({key:e.id,item:e,setIsEditing:v,isEditing:p,disableActions:i,rowNumber:a},t))}));return r.a.createElement("div",{className:"list"},w(),r.a.createElement(zt.a,null,e,y()))}())},Vt=function(){var t=Object(D.b)();return Object(a.useCallback)((function(e,n){n&&(e.type=n),t(A(e))}),[t])},$t=function(){var t=Pt(),e=Vt(),n="";"NONE"===t.status||"EXPIRED"===t.status?e(new y("Spotify Access token status not valid.  status: ".concat(t.status)),"NoSpotifyAccess"):n=t.accessToken;return Object(a.useMemo)((function(){return""===n?null:function(t){var e=t.authToken,n=t.userId;return e&&""!==e?new Ot(e):n&&""!==n?new jt(n):null}({authToken:n})}),[n])},qt=0,Qt=function(){var t=U((function(t){return t.poster.topArtistsTimeRange})),e=U((function(t){return t.poster.artists})),n=$t(),r=Object(D.b)(),i=Object(a.useCallback)((function(t){console.log(t)}),[]),o=Vt();return Object(a.useEffect)((function(){n&&function(){var e,a;yt.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(null===n||void 0===n?void 0:n.topArtists){c.next=2;break}throw new Error("Expected topArtists method to exist on spotify api object");case 2:if(!(++qt>5)){c.next=5;break}throw new Error("Max Count Reached");case 5:return i("Using api to retreive top Artists for range "+t),c.prev=6,c.next=9,yt.a.awrap(n.topArtists({time_range:t}));case 9:e=c.sent,c.next=15;break;case 12:c.prev=12,c.t0=c.catch(6),o(c.t0,"NoSpotifyAccess");case 15:if(c.prev=15,e){c.next=18;break}throw new y("Expected top artists data");case 18:if(!(e instanceof Error)){c.next=21;break}return o(e),c.abrupt("return");case 21:return a=e.map((function(t){return Xt({isSelected:!0,data:t,canEdit:!1,userAdded:!1})})),r(I(a)),c.finish(15);case 24:case"end":return c.stop()}}),null,null,[[6,12,15,24]])}()}),[r,i,o,n,t]),{topArtists:e,setTopArtistsTimeRange:function(t){r(F(t))}}},te=[{text:"Last 6 Months",value:"medium_term"},{text:"All Time",value:"long_term"},{text:"1 Month",value:"short_term"}],ee=function(){var t=Qt().setTopArtistsTimeRange,e=U((function(t){return t.poster.topArtistsTimeRange})),n=lt(te,e,(function(e){return t(e)})),i=Object(c.a)(n,2)[1],o=function(t,e,n){var r=Object(D.c)(t),i=Object(D.b)(),o=Object(a.useCallback)((function(t){i(e(t))}),[i,e]),c=Object(Bt.a)({},Jt((function(t){var n=t(r);i(e(n))})),{renderData:n});return{items:r,setItems:o,listProps:c}}((function(t){return t.poster.artists}),I,(function(t){var e=t.images[t.images.length-1].url;return r.a.createElement("span",null,r.a.createElement("img",{className:"",alt:t.name+" photo",src:e,style:{height:"50px",width:"50px",marginRight:"5px"}}),t.name)})),s=o.items,u=o.listProps;return r.a.createElement("div",null,r.a.createElement("h3",{style:{display:"inline-block"}},"Top Artists"),r.a.createElement(ht,i),r.a.createElement(Zt,Object.assign({items:s},u,{canSelect:!0})))},ne=window.location.href,ae="https://accounts.spotify.com/authorize",re="access_token",ie="token_type",oe="expires_in",ce={client_id:"f775b626d4784dfba4491742d5453d55",response_type:"token",redirect_uri:ne,scope:"user-top-read"};function se(){for(var t=[],e=0,n=Object.entries(ce);e<n.length;e++){var a=n[e],r=Object(c.a)(a,2),i=r[0],o=r[1];t.push("".concat(i,"=").concat(o))}var s=t.join("&");return"".concat(ae,"?").concat(s)}function ue(){if(Yt)return{status:"AUTHORIZED",data:Yt};var t={},e=window.location.href.split("#");if(2!==e.length)return{status:"NOT_AUTHORIZED"};var n=e[1].split("&"),a=!0,r=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value.split("="),l=Object(c.a)(u,2),h=l[0],f=l[1];t[h]=f}}catch(p){r=!0,i=p}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}if(t.hasOwnProperty("error"))return{status:"ACCESS_DENIED"};var d="";return t.hasOwnProperty(re)||(d="Hash fragment does not contain field: ".concat(re)),t.hasOwnProperty(oe)||(d="Hash fragment does not contain field: ".concat(oe)),t.hasOwnProperty(ie)||(d="Hash fragment does not contain field: ".concat(ie)),""!==d?{status:"ERROR",error:d}:{status:"AUTHORIZED",data:t}}var le=function(){return r.a.createElement("div",{className:"h-100 d-flex justify-content-center align-items-center"},r.a.createElement("a",{className:"btn btn-success",role:"button",href:se()},"Authorize Spotify"))},he=function(t){var e=t.active,n=t.toggle,a=e?300:0,i="VALID"!==Pt().status;return r.a.createElement("div",{className:"sidenav ",style:{width:a}},r.a.createElement("a",{href:"#",className:"closebtn",onClick:n},"\xd7"),i&&r.a.createElement(le,null),!i&&r.a.createElement(ee,null))},fe=function(){var t=Object(a.useState)(!1),e=Object(c.a)(t,2),n=e[0],i=e[1],o=function(){return i(!n)},f=It(),d=Object(c.a)(f,2),p=d[0],v=d[1],m=null===p||void 0===p?void 0:p.width,b=null===p||void 0===p?void 0:p.height;return r.a.createElement("div",{className:"home h-100"},r.a.createElement(s.a,{className:"navbar navbar-expand-sm navbar-light bg-light py-0",style:{marginBottom:"10px"}},r.a.createElement(pt,{className:"mr-2",onClick:function(){return o()}},"Artists"),r.a.createElement("div",{className:"navbar-brand"},"Poster App"),null),r.a.createElement(he,{active:n,toggle:o}),r.a.createElement(bt,null),r.a.createElement("div",{ref:v,className:"h-100"},r.a.createElement(u.a,{className:"h-100"},r.a.createElement(l.a,null,r.a.createElement(h.a,{className:"d-flex justify-content-center"},r.a.createElement(it,{parentWidth:m,parentHeight:b}))))))},de=n(93),pe=function(){return r.a.createElement(de.b,{to:"/"})},ve=function(){var t=Object(D.b)(),e=ue();if("AUTHORIZED"!==e.status)return console.log("Non Authorized status: ".concat(e.status)),console.log(e.error),pe();if(!e.data)throw new Error("Received authorized status without data");var n=e.data,a=n.access_token,r=n.expires_in;return t(j({spotifyAccessToken:a,spotifyAccessTokenExpire:r})),pe()},me=function(){var t=Object(D.b)(),e=ue();if("AUTHORIZED"!==e.status);else{if(!e.data)throw new Error("Received authorized status without data");var n=e.data,a=n.access_token,i=n.expires_in,o=parseInt(i,10);if(isNaN(o))throw new Error("Spotify did not return a valid number ".concat(i));var c=Ft()+o;window.location.hash="",t(j({spotifyAccessToken:a,spotifyAccessTokenExpire:c.toString()}))}return r.a.createElement("div",{className:"App"},r.a.createElement(de.d,null,r.a.createElement(de.c,{exact:!0,path:"/authenticate"},r.a.createElement(ve,null)),r.a.createElement(de.c,{exact:!0,path:"/"},r.a.createElement(fe,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var be=window.localStorage.getItem("__REDUX_LOCAL_STORAGE_KEY"),ge=be?JSON.parse(be):void 0,ye=[function(t){return function(e){return function(n){var a=e(n),r=t.getState(),i=JSON.stringify(r);return window.localStorage.setItem("__REDUX_LOCAL_STORAGE_KEY",i),a}}}],we=Object(E.a)({reducer:L,preloadedState:ge,middleware:ye}),Ee=(n(94),n(91),n(92),function(t){var e=t.children,n=U((function(t){return t.system.error})),i=Object(a.useState)(!1),o=Object(c.a)(i,2),s=o[0],u=o[1];if(!n.isError||!n.error)return s&&u(!s),r.a.createElement(r.a.Fragment,null,e);var l=n.error;if(console.log("isError: ".concat(n.isError,", error: ").concat(!!l,", errorData.error: ").concat(!!n.error)),l)switch(l.type){case"NoSpotifyAccess":s||u(!0),null;break;default:r.a.createElement("h3",null,"Error"),console.error(l)}return r.a.createElement(r.a.Fragment,null,e)}),xe="version",ke=window.localStorage.getItem(xe);ke?parseInt(ke,10)<2&&(window.localStorage.clear(),window.localStorage.setItem(xe,2..toString())):(window.localStorage.clear(),window.localStorage.setItem(xe,2..toString()));o.a.render(r.a.createElement(D.a,{store:we},r.a.createElement(Ee,null,r.a.createElement(de.a,null,r.a.createElement(me,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[49,1,2]]]);
//# sourceMappingURL=main.bf6ea500.chunk.js.map